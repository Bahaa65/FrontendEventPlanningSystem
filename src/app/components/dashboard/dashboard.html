<div class="dashboard-container">

  <!-- Main Dashboard Content -->
  <div *ngIf="currentUser" class="dashboard-wrapper">

    <!-- Top Navigation Bar -->
    <header class="dashboard-topbar">
      <div class="topbar-left">
        <div class="brand">
          <h1 class="brand-title">Events</h1>
        </div>
      </div>

      <div class="topbar-right">
        <button class="btn btn-primary btn-create" (click)="goToCreateEvent()">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
            <path d="M8 3V13M3 8H13" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
          </svg>
          Create Event
        </button>

        <div class="user-menu">
          <div class="user-avatar">
            {{ currentUser.username.charAt(0).toUpperCase() }}
          </div>
          <span class="user-name">{{ currentUser.username }}</span>
          <button class="btn btn-sm btn-secondary" (click)="logout()">Logout</button>
        </div>
      </div>
    </header>

    <!-- Main Content Area -->
    <div class="dashboard-main">

      <!-- Sidebar -->
      <aside class="dashboard-sidebar">
        <div class="stats-card card">
          <h3>Quick Stats</h3>

          <div class="stats-list">
            <div class="stat-item">
              <div class="stat-content">
                <div class="stat-label">My Events</div>
                <div class="stat-value">{{ myEvents.length }}</div>
              </div>
            </div>

            <div class="stat-item">
              <div class="stat-content">
                <div class="stat-label">Upcoming</div>
                <div class="stat-value">{{ upcomingEventsCount }}</div>
              </div>
            </div>

            <div class="stat-item">
              <div class="stat-content">
                <div class="stat-label">Next 7 Days</div>
                <div class="stat-value">{{ upcomingNext7Days }}</div>
              </div>
            </div>

            <div class="stat-item">
              <div class="stat-content">
                <div class="stat-label">Pending Invites</div>
                <div class="stat-value">{{ pendingInvitations }}</div>
              </div>
            </div>
          </div>
        </div>
      </aside>

      <!-- Events Section -->
      <section class="events-section">

        <!-- Tabs -->
        <div class="tabs-container">
          <button class="tab-button" [class.active]="activeTab === 'my-events'" (click)="switchTab('my-events')">
            My Events
          </button>
          <button class="tab-button" [class.active]="activeTab === 'invited-events'" (click)="switchTab('invited-events')">
            Invited Events
          </button>
        </div>

        <!-- Search -->
        <div class="search-filter-bar">
          <input type="text"
                 placeholder="Search events..."
                 [(ngModel)]="searchQuery"
                 (ngModelChange)="onSearchChange()">

          <div class="filter-buttons">
            <button (click)="setFilter('all')">All</button>
            <button (click)="setFilter('upcoming')">Upcoming</button>
            <button (click)="setFilter('past')">Past</button>
          </div>
        </div>

        <!-- Error -->
        <div *ngIf="error" class="error-banner">
          {{ error }}
          <button (click)="retryLoad()">Retry</button>
        </div>

        <!-- Empty -->
        <div *ngIf="displayedEvents.length === 0 && !error" class="empty-state">
          <h3>No events found</h3>
          <button *ngIf="activeTab === 'my-events'" (click)="goToCreateEvent()">Create Event</button>
        </div>

        <!-- Events Grid -->
        <div *ngIf="displayedEvents.length > 0" class="events-grid">
          <div *ngFor="let event of displayedEvents" class="event-card">

            <h3 (click)="viewEvent(event)">
              {{ event.title }}
            </h3>

            <p>{{ formatDate(event.date) }}</p>
            <p *ngIf="event.location">{{ event.location }}</p>
            <p *ngIf="event.description">{{ event.description }}</p>

            <div class="event-footer">
              <button (click)="viewEvent(event)">View</button>

              <button *ngIf="event.role === 'organizer'"
                      (click)="confirmDelete(event)">
                Delete
              </button>
            </div>

          </div>
        </div>

      </section>
    </div>
  </div>

  <!-- Delete Confirmation -->
  <div *ngIf="showDeleteDialog" class="modal-overlay" (click)="cancelDelete()">
    <div class="modal-dialog" (click)="$event.stopPropagation()">

      <h3>Confirm Delete</h3>
      <p>Are you sure you want to delete "{{ eventToDelete?.title }}"?</p>

      <button (click)="cancelDelete()">Cancel</button>
      <button (click)="deleteEvent()">Delete</button>

    </div>
  </div>

</div>
